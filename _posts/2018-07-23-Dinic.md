---
layout:     post
title:      "Dinic"
subtitle:   "悲剧的POJ"
date:       2018-05-13
author:     "JU"
header-img: "img/post-bg-2015.jpg"
mathjax:    false
catalog:    true
tags:
    - 网络流
---

## 当前弧优化
### BZOJ3438

    #include <iostream>
    #include <cmath>
    #include <cstdio>
    #include <queue>
    #include <cstring>
    #define sc(p) scanf("%d",&p)
    #define pr(p) printf("%d\n",p)
    const int oo=2100000000;
    const int N=1010000;
    using namespace std;
    int top[N],tot=1,d[N],s,t;
    struct EDGE { int v,nx,len; }lb[4100000];
    void add (int u,int v,int len)
    {
        lb[++tot].v=v,lb[tot].len=len,lb[tot].nx=top[u],top[u]=tot;
        lb[++tot].v=u,lb[tot].len= 0 ,lb[tot].nx=top[v],top[v]=tot;
    }
    queue <int> q;
    int cur[N]={0};
    bool bfs ()
    {
        memset (d,0,sizeof (d));
        memcpy (cur,top,sizeof (top));
        while (q.size()) q.pop();
        q.push(s),d[s]=1; bool ly=0;
        while (q.size())
        {
            int u=q.front(); q.pop();
            for (int kb=top[u]; kb!=-1; kb=lb[kb].nx)
            {
                int v=lb[kb].v,len=lb[kb].len;
                if (len&&!d[v])
                {
                    q.push(v),d[v]=d[u]+1;
                    if (v==t) ly=1;
                }
            }
        }
        return ly;
    }
    int dinic (int u,int flow)
    {
        if (u==t) return flow;
        int rest=flow,k;
        for (; cur[u]!=-1&&rest; cur[u]=lb[cur[u]].nx)
        {
            int v=lb[cur[u]].v,len=lb[cur[u]].len;
            if (len&&d[v]==d[u]+1)
            {
                k=dinic (v,min (rest,len));
                if (!k)d[v]=0;
                lb[cur[u]].len-=k,lb[cur[u]^1].len+=k;
                rest-=k;
                if (rest==0) break;
            }
        }
        return flow-rest;
    }
    int main()
    {
        int n,m;
        memset (top,-1,sizeof (top));
        sc(n); s=n+1,t=s+1; int sum=0;
        for (int i=1; i<=n; i++) { int a; sc(a); add (s,i,a); sum+=a; }
        for (int i=1; i<=n; i++) { int b; sc(b); add (i,t,b); sum+=b; }
        sc(m);
        for (int i=1; i<=m; i++)
        {
            int k; sc(k);
            int c1,c2; sc(c1),sc(c2); sum+=c1+c2;
            add (s,n+2+i,c1); add (n+2+i+m,t,c2);
            for (int j=1; j<=k; j++) { int z; sc(z); add (n+2+i,z,oo),add (z,n+2+i+m,oo); }
        }
        int ans=0,flow=0;
        while (bfs ())
        while (flow=dinic (s,oo)) ans+=flow;
        pr(sum-ans);
        return 0;
    }

---

